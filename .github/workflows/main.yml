name: VPS

on: workflow_dispatch

jobs:
  build:

    runs-on: ubuntu-latest
    timeout-minutes: 9999

    steps:
    - name: Update
      run: sudo apt-get update
    - name: Install Package
      run: sudo apt-get install -y openssh-server screen cpulimit pwgen 
    - name: Setup SSH
      run: | 
        echo "root:toor"|sudo chpasswd
        sudo mkdir -p /var/run/sshd
        echo "PermitRootLogin yes" >> /etc/ssh/sshd_config
        echo "PasswordAuthentication yes" >> /etc/ssh/sshd_config
        echo "LD_LIBRARY_PATH=/usr/lib64-nvidia" >> /root/.bashrc
        echo "export LD_LIBRARY_PATH" >> /root/.bashrc
        sudo sshd -D
    - name: Install Pyngrok
      run: sudo pip install pyngrok -q
    - name: Connecting to your Ngrok account.
      run: ngrok authtoken $Env:NGROK_AUTH_TOKEN
      env:
        NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
    - name: Create ngrok Tunnel
      run: sudo wget "https://github.com/ckpakbar23/VPS/raw/main/ngrok.py" -O- |python
    - name: Loop
      run: sudo wget "https://github.com/ckpakbar23/VPS/raw/main/loop" -O- | bash
      
